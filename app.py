import streamlit as st
import openai
import os

# í˜ì´ì§€ ì„¤ì •
st.set_page_config(page_title="ì˜ë£Œê¸°ê¸° ê´‘ê³  ì‹¬ì˜ê¸°", page_icon="ğŸ¥")

# ì œëª© ë° ì„¤ëª…
st.title("ğŸ¥ 3,4ë“±ê¸‰ ì˜ë£Œê¸°ê¸° ê´‘ê³  AI ê²€ìˆ˜ê¸°")
st.write("ì˜ë£Œê¸°ê¸°ë²• ì œ24ì¡° ë° ì‹œí–‰ê·œì¹™ ë³„í‘œ7ì— ì˜ê±°í•˜ì—¬ ê´‘ê³  ë¬¸êµ¬ë¥¼ ê²€ìˆ˜í•©ë‹ˆë‹¤.")

# API í‚¤ ì„¤ì • (Streamlit Cloudì˜ Secretsì—ì„œ ê°€ì ¸ì˜´)
# ë¡œì»¬ í…ŒìŠ¤íŠ¸ìš©ì´ ì•„ë‹ˆë¼ ë°°í¬ìš©ì´ë¯€ë¡œ í™˜ê²½ë³€ìˆ˜ ì²˜ë¦¬
api_key = st.secrets.get("OPENAI_API_KEY")

if not api_key:
    st.error("API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.")
    st.stop()

client = openai.OpenAI(api_key=api_key)

# ì…ë ¥ì°½
ad_text = st.text_area("ê²€ìˆ˜í•  ê´‘ê³  ë¬¸êµ¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”:", height=200)

if st.button("ê´‘ê³  ê·œì • ê²€ìˆ˜ ì‹œì‘"):
    if not ad_text:
        st.warning("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.")
    else:
        with st.spinner("AIê°€ ë²•ë ¹ì„ ê²€í†  ì¤‘ì…ë‹ˆë‹¤..."):
            
            regulations = """
            ë‹¹ì‹ ì€ ëŒ€í•œë¯¼êµ­ ì‹ì•½ì²˜(MFDS)ì˜ ì—„ê²©í•œ ì˜ë£Œê¸°ê¸° ê´‘ê³  ì‹¬ì˜ê´€ì…ë‹ˆë‹¤.
            ì‚¬ìš©ìê°€ ì…ë ¥í•œ '3,4ë“±ê¸‰ ì˜ë£Œê¸°ê¸°' ê´‘ê³  ë¬¸êµ¬ë¥¼ ë‹¤ìŒ ë²•ë ¹ì— ì˜ê±°í•´ ì—„ê²©íˆ ê²€ìˆ˜í•˜ì„¸ìš”.

            [ê²€ìˆ˜ ê¸°ì¤€: ì˜ë£Œê¸°ê¸°ë²• ì œ24ì¡° ë° ì‹œí–‰ê·œì¹™ ë³„í‘œ7]
            1. ê±°ì§“/ê³¼ëŒ€ ê´‘ê³  ê¸ˆì§€: í—ˆê°€ë°›ì§€ ì•Šì€ íš¨ëŠ¥ ì–¸ê¸‰ ê¸ˆì§€.
            2. ì ˆëŒ€ì  í‘œí˜„ ê¸ˆì§€: "ìµœê³ ", "ìµœìƒ", "ìœ ì¼", "ê¸°ì ì˜", "100% ì™„ì¹˜" ì‚¬ìš© ë¶ˆê°€.
            3. ì „ë¬¸ê°€ ì¶”ì²œ ê¸ˆì§€: ì˜ì‚¬, ì•½ì‚¬ ë“±ì´ ì œí’ˆì„ ì¶”ì²œí•œë‹¤ëŠ” ë‚´ìš© ê¸ˆì§€.
            4. 3,4ë“±ê¸‰ í•„ìˆ˜ ì‚¬í•­: ë¶€ì‘ìš© ìš°ë ¤ê°€ í° ë“±ê¸‰ì´ë¯€ë¡œ 'ì‚¬ìš© ì‹œ ì£¼ì˜ì‚¬í•­', 'ë¶€ì‘ìš©' ì–¸ê¸‰ì´ í•„ìˆ˜.
            5. ê³µì‚°í’ˆ ì˜¤ì¸ ë¶ˆê°€: ì˜ë£Œê¸°ê¸°ì„ì„ ëª…ì‹œí•´ì•¼ í•¨.

            [ì¶œë ¥ í˜•ì‹]
            1. íŒì • ê²°ê³¼: [ìŠ¹ì¸ / ìˆ˜ì • í•„ìš” / ë°˜ë ¤]
            2. ìœ„í—˜ ë“±ê¸‰: 3,4ë“±ê¸‰ (ê³ ìœ„í—˜)
            3. ìœ„ë°˜ ì˜ì‹¬ ì‚¬í•­:
               - (ìœ„ë°˜ëœ ë¬¸êµ¬) -> (ì´ìœ  ì„¤ëª…)
            4. ìˆ˜ì • ì œì•ˆ: (êµ¬ì²´ì ì¸ ëŒ€ì²´ ë¬¸êµ¬)
            """

            try:
                response = client.chat.completions.create(
                    model="gpt-4o",
                    messages=[
                        {"role": "system", "content": regulations},
                        {"role": "user", "content": ad_text}
                    ],
                    temperature=0.1
                )
                result = response.choices[0].message.content
                st.success("ê²€ìˆ˜ ì™„ë£Œ!")
                st.markdown(result) # ê²°ê³¼ ì¶œë ¥
                
            except Exception as e:
                st.error(f"ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {e}")